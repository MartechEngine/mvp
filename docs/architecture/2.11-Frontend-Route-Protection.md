Phase: 2 - User Identity & Authentication
Part: 2.11
Title: Frontend Route Protection Guard
Depends On: 2.10.3-Frontend-App-Shell-UI.md
Objective: To establish a robust route protection mechanism in the frontend application. This RouteGuard component will use our useCurrentUser hook to protect private routes from unauthenticated users, automatically redirecting them to the login page.
1. Core Principle: Declarative Protection
Instead of adding protection logic to every single page, we will use a single Higher-Order Component (HOC) called RouteGuard. We can wrap any layout or page with this component to secure all of its children. This is a clean, reusable, and declarative way to apply route protection.
2. RouteGuard Component Implementation
The RouteGuard component is the core of our frontend security. It checks the user's authentication state and handles redirects.
File Location: frontend/src/components/auth/RouteGuard.tsx
File Content:
'use client';

import { useCurrentUser } from '@/hooks/useAuth';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';
import { Loader2 } from 'lucide-react';

export function RouteGuard({ children }: { children: React.ReactNode }) {
  const { data: user, isLoading, isError } = useCurrentUser();
  const router = useRouter();

  useEffect(() => {
    // If the query is not loading and there's an error or no user,
    // it means the user is not authenticated.
    if (!isLoading && (isError || !user)) {
      router.replace('/login');
    }
  }, [isLoading, isError, user, router]);

  // While the authentication status is being determined, show a loading screen.
  // This prevents a "flash" of the protected content before the redirect can happen.
  if (isLoading) {
    return (
      <div className="flex h-screen w-full items-center justify-center">
        <Loader2 className="h-8 w-8 animate-spin" />
      </div>
    );
  }

  // If the user is authenticated (not loading and no error), render the protected content.
  if (user) {
    return <>{children}</>;
  }

  // Render null while redirecting to prevent content flash.
  return null;
}
3. Integration into the Dashboard Layout
We have already integrated this component in the previous step. The /(dashboard)/layout.tsx file is already wrapped with the <RouteGuard>, so no further changes are needed there. This single placement now protects every page under the /(dashboard) route group.
File Review: frontend/src/app/(dashboard)/layout.tsx
import { RouteGuard } from '@/components/auth/RouteGuard'; // Correctly imported
import { Header } from '@/components/layout/Header';
import { Sidebar } from '@/components/layout/Sidebar';

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    // This wrapper now secures the Header, Sidebar, and all child pages.
    <RouteGuard>
      <div className="flex h-screen w-full overflow-hidden bg-muted/40">
        {/* ... rest of the layout ... */}
      </div>
    </RouteGuard>
  );
}
4. Verification
Run the application (docker-compose up).
Clear your cookies to ensure you are logged out.
Try to navigate directly to http://localhost:3000/dashboard.
Expected Behavior: You should see the loading spinner for a moment, and then be immediately redirected to the /login page. The protected dashboard content will never be visible.
After logging in, you will be redirected to /dashboard and, because you are now authenticated, the RouteGuard will allow the content to be rendered.
5. Conclusion of Phase 2
This file concludes the architectural work for Phase 2. We have now designed a complete, end-to-end system for user identity and authentication. The application has:
A secure backend for registration and login.
A robust frontend data layer for managing auth state.
A clean and intuitive UI for all authentication forms.
A secure layout and route protection for authenticated users.
The next phase will build upon this foundation to implement the core application features.
Next File: 2.12-Data-Models-Projects.md will begin Phase 3 by defining the database schema for projects.