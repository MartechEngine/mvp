Phase: 1 - Foundation & Core Infrastructure
Part: 1.8
Title: Frontend App Shell & Root Redirect Logic
Depends On: 1.7-Backend-Application-Initialization.md
Objective: To initialize the Next.js web application shell. This phase will not build a marketing homepage. Instead, it will create the fundamental root layout and the core logic at the root (/) of the application to properly redirect users based on their authentication state.
1. Production-Ready Root Layout
This is the top-level layout for the entire application. It is crucial for setting up global styles, fonts, and our Providers component.
File Location: frontend/src/app/layout.tsx (Modification)
File Content:
import type { Metadata, Viewport } from 'next';
import { Inter } from 'next/font/google';
import { Providers } from './providers';
import './globals.css';

const inter = Inter({ subsets: ['latin'], variable: '--font-sans' });

// This metadata serves as a fallback for auth pages.
export const metadata: Metadata = {
  title: {
    default: 'MartechEngine',
    template: '%s | MartechEngine',
  },
  description: 'Login or sign up to access the MartechEngine platform.',
  // Prevent indexing of the entire app domain by default. Specific pages can override this.
  robots: {
    index: false,
    follow: false,
  },
};

export const viewport: Viewport = {
  width: 'device-width',
  initialScale: 1,
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`font-sans ${inter.variable} bg-background text-foreground antialiased`}>
        <Providers>
          {/* A minimal layout for the app shell */}
          {children}
        </Providers>
      </body>
    </html>
  );
}
2. Root Page Redirect Component (page.tsx)
This is the most critical part of this file. The root page of app.martechengine.ai is not a destination; it is a router. Its only job is to direct traffic based on authentication status.
File Location: frontend/src/app/page.tsx (Modification)
File Content:
"use client";

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/hooks/useAuth'; // Note: This hook will be fully created in Phase 2

export default function RootPage() {
  const router = useRouter();
  
  // Note: For now, we simulate the hook's loading state.
  // This will be replaced by the actual `useAuth` hook in Phase 2, which will
  // check for a valid auth token.
  const { user, isLoading } = useAuth() || { user: null, isLoading: true };

  useEffect(() => {
    // Wait until the authentication status is determined.
    if (!isLoading) {
      if (user) {
        // If the user is authenticated, send them to their dashboard.
        router.replace('/dashboard');
      } else {
        // If the user is not authenticated, send them to the login page.
        router.replace('/login');
      }
    }
  }, [isLoading, user, router]);

  // Render a full-page loading spinner while the redirect is being determined.
  // This prevents any flash of content and provides a smooth transition.
  return (
    <div className="flex h-screen w-full items-center justify-center bg-background">
      <div className="flex flex-col items-center space-y-4">
        {/* We can replace this with a more branded loader later */}
        <div className="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent" />
        <p className="text-muted-foreground">Loading your workspace...</p>
      </div>
    </div>
  );
}
3. Verification & Expected Outcome
Run docker-compose up.
Navigate to http://localhost:3000 (which simulates app.martechengine.ai).
Expected Behavior: You will see the "Loading your workspace..." message for a moment.
Since the useAuth hook is not fully implemented yet and user will be null, the page will immediately redirect you to http://localhost:3000/login.
You will see a Next.js 404 Not Found error because the /login page doesn't exist yet. This is the correct and expected outcome for this phase.
This confirms that the root of our application is correctly acting as a router, ready for the authentication system we will build next. This concludes Phase 1.
