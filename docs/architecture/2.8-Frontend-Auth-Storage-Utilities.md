Phase: 2 - User Identity & Authentication
Part: 2.8
Title: Frontend Authentication Storage Utilities
Depends On: 2.7-Frontend-API-Service-Layer.md
Objective: To create a set of simple, secure, and synchronous utility functions for managing JWTs in the browser's cookies. This module will abstract away the direct use of the js-cookie library and centralize cookie names and security options.
1. Core Principle: Secure and Centralized Storage
We will use browser cookies to store authentication tokens. This allows the tokens to be automatically sent with server-side requests in the future and provides a standard storage mechanism.
To manage this securely and consistently, we will:
Use the js-cookie library for reliable, cross-browser cookie management.
Define all cookie names as constants to prevent typos.
Create a centralized function for cookie security options (secure, sameSite) that adapts to the environment (development vs. production).
Provide simple, well-named functions (setAuthTokens, getAuthToken, etc.) for the rest of the application to use.
2. Dependency Installation
This module requires the js-cookie library and its corresponding TypeScript types.
Installation Command (run in the frontend directory):
npm install js-cookie
npm install --save-dev @types/js-cookie```

### **3. Authentication Storage Utilities**

This file contains the complete set of functions for managing auth tokens.

**File Location:** `frontend/src/lib/utils/auth-storage.ts`
**File Content:**
```typescript
import Cookies from 'js-cookie';
import { TokenResponse } from '@/types/auth';

// --- Constants ---
// Using constants prevents typos and centralizes the cookie names.
const ACCESS_TOKEN_KEY = 'martech_access_token';
const REFRESH_TOKEN_KEY = 'martech_refresh_token';

// --- Configuration ---

/**
 * Returns environment-aware security options for cookies.
 * In production, cookies are marked as 'secure' (HTTPS only).
 */
const getCookieOptions = (): Cookies.CookieAttributes => {
  const isProduction = process.env.NEXT_PUBLIC_APP_ENV === 'production';
  return {
    // secure: isProduction, // Use this line if your production site uses HTTPS
    sameSite: 'lax', // 'lax' is a good default for security and usability.
    path: '/',
  };
};

// --- Core Utility Functions ---

/**
 * Stores the access and refresh tokens in browser cookies.
 * @param tokens - The token object received from the API.
 */
export function setAuthTokens(tokens: TokenResponse): void {
  const options = getCookieOptions();
  
  // The access token is typically short-lived. We can set an expiration based on the token's lifetime.
  // For simplicity, we'll set it to expire in 1 day for the MVP.
  Cookies.set(ACCESS_TOKEN_KEY, tokens.access_token, { 
    ...options, 
    expires: 1 // Expires in 1 day
  });

  // The refresh token is long-lived and used to get new access tokens.
  Cookies.set(REFRESH_TOKEN_KEY, tokens.refresh_token, {
    ...options,
    expires: 30 // Expires in 30 days
  });
}

/**
 * Retrieves the access token from cookies.
 * @returns The access token string, or null if not found.
 */
export function getAuthToken(): string | null {
  return Cookies.get(ACCESS_TOKEN_KEY) || null;
}

/**
 * Retrieves the refresh token from cookies.
 * @returns The refresh token string, or null if not found.
 */
export function getRefreshToken(): string | null {
  return Cookies.get(REFRESH_TOKEN_KEY) || null;
}

/**
 * Removes all authentication-related tokens from cookies.
 * This is used during logout.
 */
export function clearAuthTokens(): void {
  const options = { path: getCookieOptions().path };
  Cookies.remove(ACCESS_TOKEN_KEY, options);
  Cookies.remove(REFRESH_TOKEN_KEY, options);
}

4. Integration & Next Steps
apiClient Integration: The apiClient we built in the previous step already depends on these functions. Its request interceptor will use getAuthToken() to attach the token to every API call.
Hook Integration: The higher-level custom hooks we build next will use setAuthTokens() upon successful login and clearAuthTokens() upon logout.
With these low-level utilities in place, we have completed the foundation of our client-side authentication system. All the pieces are now ready to be assembled into the user-facing hooks.
Next File: 2.9-Frontend-Auth-Hooks.md will create the custom React Query hooks (useAuth, useLogin, etc.) that connect our UI components to the authentication services and storage utilities, completing the entire authentication data flow.